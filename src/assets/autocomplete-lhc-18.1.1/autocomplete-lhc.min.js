var Def=function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){var s={};s.PrototypeAPI=i(1),i(2),i(3)(s),i(4)(s.PrototypeAPI.$,jQuery,s),i(5)(s.PrototypeAPI,s.Effect),i(6)(s.PrototypeAPI.$,s),i(7)(s),i(8)(s),i(9)(s.PrototypeAPI.$,jQuery,s),i(10)(s.PrototypeAPI.$,jQuery,s),i(11)(s),i(12)(s.PrototypeAPI.$,jQuery,s),i(13)(s.PrototypeAPI.$,jQuery,s),i(14)(s.PrototypeAPI.$,jQuery,s),i(15)(s.PrototypeAPI.$,jQuery,s),i(16)(s),t.exports=s},function(t,e,i){if(void 0===s)var s={};s.PrototypeAPI=function(){"use strict";var t={};function e(t){if(!t)return[];if("toArray"in Object(t))return t.toArray();for(var e=t.length||0,i=new Array(e);e--;)i[e]=t[e];return i}function i(t){var e=t;return s.PrototypeAPI.isString(t)&&(e=document.getElementById(t)),e}var o,n,r=Object.prototype.toString,a=(o="undefined"!=typeof navigator&&navigator.userAgent,n="[object Opera]"==Object.prototype.toString.call(window.opera),{IE:!!window.attachEvent&&!n,Opera:n,WebKit:o&&o.indexOf("AppleWebKit/")>-1,Gecko:o&&o.indexOf("Gecko")>-1&&-1===o.indexOf("KHTML"),MobileSafari:o&&/Apple.*Mobile/.test(o)});function l(t){return"[object Function]"===r.call(t)}function h(t){return t}var u=function(){var t=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}();function i(){}return{create:function(){var t=null,s=e(arguments);function o(){this.initialize.apply(this,arguments)}l(s[0])&&(t=s.shift()),function(t,e){for(var i in e)t[i]=e[i]}(o,u.Methods),o.superclass=t,o.subclasses=[],t&&(i.prototype=t.prototype,o.prototype=new i,t.subclasses.push(o));for(var n=0,r=s.length;n<r;n++)o.addMethods(s[n]);return o.prototype.initialize||(o.prototype.initialize=function(){}),o.prototype.constructor=o,o},Methods:{addMethods:function(e){var i,s,o=this.superclass&&this.superclass.prototype,n=Object.keys(e);t&&(e.toString!=Object.prototype.toString&&n.push("toString"),e.valueOf!=Object.prototype.valueOf&&n.push("valueOf"));for(var r=0,a=n.length;r<a;r++){var h=n[r],u=e[h];if(o&&l(u)&&"$super"==(i=u,s=void 0,s=i.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(","),1!=s.length||s[0]?s:[])[0]){var c=u;(u=function(t){return function(){return o[t].apply(this,arguments)}}(h).wrap(c)).valueOf=function(t){return function(){return t.valueOf.call(t)}}(c),u.toString=function(t){return function(){return t.toString.call(t)}}(c)}this.prototype[h]=u}return this}}}}(),c=function(){function i(e,i){e=e||h;var s=!0;return this.each(function(o,n){if(!(s=s&&!!e.call(i,o,n,this)))throw t},this),s}function o(e,i){e=e||h;var s=!1;return this.each(function(o,n){if(s=!!e.call(i,o,n,this))throw t},this),s}function n(t,e){t=t||h;var i=[];return this.each(function(s,o){i.push(t.call(e,s,o,this))},this),i}function r(e,i){var s;return this.each(function(o,n){if(e.call(i,o,n,this))throw s=o,t},this),s}function a(t,e){var i=[];return this.each(function(s,o){t.call(e,s,o,this)&&i.push(s)},this),i}function u(e){if(l(this.indexOf)&&-1!=this.indexOf(e))return!0;var i=!1;return this.each(function(s){if(s==e)throw i=!0,t}),i}function c(){return this.map()}return{each:function(e,i){try{this._each(e,i)}catch(e){if(e!=t)throw e}return this},eachSlice:function(t,e,i){var s=-t,o=[],n=this.toArray();if(t<1)return n;for(;(s+=t)<n.length;)o.push(n.slice(s,s+t));return o.collect(e,i)},all:i,every:i,any:o,some:o,collect:n,map:n,detect:r,findAll:a,select:a,filter:a,grep:function(t,e,i){e=e||h;var o=[];return s.PrototypeAPI.isString(t)&&(t=new RegExp(RegExp.escape(t))),this.each(function(s,n){t.match(s)&&o.push(e.call(i,s,n,this))},this),o},include:u,member:u,inGroupsOf:function(t,e){return e=Object.isUndefined(e)?null:e,this.eachSlice(t,function(i){for(;i.length<t;)i.push(e);return i})},inject:function(t,e,i){return this.each(function(s,o){t=e.call(i,t,s,o,this)},this),t},invoke:function(t){var i=e(arguments).slice(1);return this.map(function(e){return e[t].apply(e,i)})},max:function(t,e){var i;return t=t||h,this.each(function(s,o){s=t.call(e,s,o,this),(null==i||s>=i)&&(i=s)},this),i},min:function(t,e){var i;return t=t||h,this.each(function(s,o){s=t.call(e,s,o,this),(null==i||s<i)&&(i=s)},this),i},partition:function(t,e){t=t||h;var i=[],s=[];return this.each(function(o,n){(t.call(e,o,n,this)?i:s).push(o)},this),[i,s]},pluck:function(t){var e=[];return this.each(function(i){e.push(i[t])}),e},reject:function(t,e){var i=[];return this.each(function(s,o){t.call(e,s,o,this)||i.push(s)},this),i},sortBy:function(t,e){return this.map(function(i,s){return{value:i,criteria:t.call(e,i,s,this)}},this).sort(function(t,e){var i=t.criteria,s=e.criteria;return i<s?-1:i>s?1:0}).pluck("value")},toArray:c,entries:c,zip:function(){var t=e(arguments),i=[this].concat(t).map(e);return this.map(function(t,e){for(var s=[],o=0,n=i.length;o<n;++o)s.push(i[o][e]);return s})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"},find:r}}();function d(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var p={setOpacity:function(t,e){return 1==e||""===e?e="":e<1e-5&&(e=0),(t=i(t)).style.opacity=e,t},setStyle:function(t,e){var o=(t=i(t)).style;if(s.PrototypeAPI.isString(e)){if(o.cssText+=";"+e,e.include("opacity")){var n=e.match(/opacity:\s*(\d?\.?\d*)/)[1];s.PrototypeAPI.setOpacity(t,n)}return t}for(var r in e)if("opacity"===r)s.PrototypeAPI.setOpacity(t,e[r]);else{var a=e[r];"float"!==r&&"cssFloat"!==r||(r=void 0===o.styleFloat?"cssFloat":"styleFloat"),o[r]=a}return t},getStyle:function(t,e){var s=(t=i(t)).style[e];if(!s||"auto"===s){var o=document.defaultView.getComputedStyle(t,null);s=o?o[e]:null}return"opacity"===e?s?parseFloat(s):1:"auto"===s?null:s},makePositioned:function(t){t=i(t);var e=s.PrototypeAPI.getStyle(t,"position"),o={};return"static"!==e&&e||(o.position="relative",s.PrototypeAPI.Browser.Opera&&(o.top=0,o.left=0),s.PrototypeAPI.setStyle(t,o),jQuery(t).data("prototype_made_positioned",!0)),t},undoPositioned:function(t){t=i(t);var e=jQuery(t);return e.data("prototype_made_positioned")&&(e.removeData("prototype_made_positioned"),s.PrototypeAPI.setStyle(t,{position:"",top:"",bottom:"",left:"",right:""})),t}};return{$:i,Class:u,Enumerable:c,isString:function(t){return"[object String]"===r.call(t)},isArray:function(t){return"[object Array]"===r.call(t)},Browser:a,parseQuery:function(t){var e=t.trim().match(/([^?#]*)(#.*)?$/);if(!e)return{};for(var i=e[1].split("&"),s=0,o=i.length;s<o;++s){var n=i[s];if((n=n.split("="))[0]){var r=decodeURIComponent(n.shift()),a=n.length>1?n.join("="):n[0];null!=a&&(a=a.gsub("+"," "),a=decodeURIComponent(a)),r in hash?(this.isArray(hash[r])||(hash[r]=[hash[r]]),hash[r].push(a)):hash[r]=a}}return{}},escapeHTML:d,escapeAttribute:d,getStyle:p.getStyle,setStyle:p.setStyle,makePositioned:p.makePositioned,undoPositioned:p.undoPositioned,$A:e}}(),t.exports=s.PrototypeAPI},function(t,e){"function"!=typeof Object.assign&&(Object.assign=function(t){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var o in s)s.hasOwnProperty(o)&&(e[o]=s[o])}return e}),String.prototype.trimLeft=function(){for(var t=-1;this.charCodeAt(++t)<33;);return this.slice(t,this.length)}},function(t,e,i){!function(){t.exports=function(t){t.jqueryLite=function(){"use strict";return{ui:{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}}}(),Object.assign(jQuery,t.jqueryLite)}}()},function(t,e,i){if(void 0===s)var s={};!function(){t.exports=function(t,e,i){"use strict";var s=i.PrototypeAPI.Class,o=i.PrototypeAPI.Enumerable,n=(i.PrototypeAPI.$A,i.PrototypeAPI.isString),r={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:function(t){return t},sinoidal:function(t){return-Math.cos(t*Math.PI)/2+.5},reverse:function(t){return 1-t},flicker:function(t){return(t=-Math.cos(t*Math.PI)/4+.75+Math.random()/4)>1?1:t},wobble:function(t){return-Math.cos(t*Math.PI*(9*t))/2+.5},pulse:function(t,e){return-Math.cos(t*((e||5)-.5)*2*Math.PI)/2+.5},spring:function(t){return 1-Math.cos(4.5*t*Math.PI)*Math.exp(6*-t)},none:function(t){return 0},full:function(t){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"}};r.DefaultOptions.transition=r.Transitions.sinoidal,r.ScopedQueue=s.create(o,{initialize:function(){this.effects=[],this.interval=null},_each:function(t){this.effects._each(t)},add:function(t){var i=(new Date).getTime();switch(n(t.options.queue)?t.options.queue:t.options.queue.position){case"front":this.effects.findAll(function(t){return"idle"==t.state}).each(function(e){e.startOn+=t.finishOn,e.finishOn+=t.finishOn});break;case"with-last":i=this.effects.pluck("startOn").max()||i;break;case"end":i=this.effects.pluck("finishOn").max()||i}t.startOn+=i,t.finishOn+=i,(!t.options.queue.limit||this.effects.length<t.options.queue.limit)&&this.effects.push(t),this.interval||(this.interval=setInterval(e.proxy(this.loop,this),15))},remove:function(t){for(var e;(e=this.effects.indexOf(t))>-1;)this.effects.splice(e,1);0==this.effects.length&&(clearInterval(this.interval),this.interval=null)},loop:function(){for(var t=(new Date).getTime(),e=0,i=this.effects.length;e<i;e++)this.effects[e]&&this.effects[e].loop(t)}}),r.Queues={instances:{},get:function(t){return n(t)?this.instances[t]||(this.instances[t]=new r.ScopedQueue):t}},r.Queue=r.Queues.get("global"),r.Base=s.create({position:null,start:function(t){t&&!1===t.transition&&(t.transition=r.Transitions.linear),this.options=e.extend(e.extend({},r.DefaultOptions),t||{}),this.currentFrame=0,this.state="idle",this.startOn=1e3*this.options.delay,this.finishOn=this.startOn+1e3*this.options.duration,this.fromToDelta=this.options.to-this.options.from,this.totalTime=this.finishOn-this.startOn,this.totalFrames=this.options.fps*this.options.duration,this.render=function(){function t(t,e){t.options[e+"Internal"]&&t.options[e+"Internal"](t),t.options[e]&&t.options[e](t)}return function(e){"idle"===this.state&&(this.state="running",t(this,"beforeSetup"),this.setup&&this.setup(),t(this,"afterSetup")),"running"===this.state&&(e=this.options.transition(e)*this.fromToDelta+this.options.from,this.position=e,t(this,"beforeUpdate"),this.update&&this.update(e),t(this,"afterUpdate"))}}(),this.event("beforeStart"),this.options.sync||r.Queues.get(n(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(t){if(t>=this.startOn){if(t>=this.finishOn)return this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),void this.event("afterFinish");var e=(t-this.startOn)/this.totalTime,i=Math.round(e*this.totalFrames);i>this.currentFrame&&(this.render(e),this.currentFrame=i)}},cancel:function(){this.options.sync||r.Queues.get(n(this.options.queue)?"global":this.options.queue.scope).remove(this),this.state="finished"},event:function(t){this.options[t+"Internal"]&&this.options[t+"Internal"](this),this.options[t]&&this.options[t](this)},inspect:function(){var t=$H();for(property in this)Object.isFunction(this[property])||t.set(property,this[property]);return"#<Effect:"+t.inspect()+",options:"+$H(this.options).inspect()+">"}}),r.Move=s.create(r.Base,{initialize:function(i){if(this.element=t(i),!this.element)throw r._elementDoesNotExistError;var s=e.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(s)},setup:function(){i.PrototypeAPI.makePositioned(this.element);var t=i.PrototypeAPI;this.originalLeft=parseFloat(t.getStyle(this.element,"left")||"0"),this.originalTop=parseFloat(t.getStyle(this.element,"top")||"0"),"absolute"==this.options.mode&&(this.options.x=this.options.x-this.originalLeft,this.options.y=this.options.y-this.originalTop)},update:function(t){i.PrototypeAPI.setStyle(this.element,{left:Math.round(this.options.x*t+this.originalLeft)+"px",top:Math.round(this.options.y*t+this.originalTop)+"px"})}}),r.Shake=function(s){s=t(s);var o=e.extend({distance:20,duration:.5},arguments[1]||{}),n=parseFloat(o.distance),a=parseFloat(o.duration)/10,l=e(s).offset(),h=i.PrototypeAPI,u={top:l.top,left:l.left};return new r.Move(s,{x:n,y:0,duration:a,afterFinishInternal:function(t){new r.Move(t.element,{x:2*-n,y:0,duration:2*a,afterFinishInternal:function(t){new r.Move(t.element,{x:2*n,y:0,duration:2*a,afterFinishInternal:function(t){new r.Move(t.element,{x:2*-n,y:0,duration:2*a,afterFinishInternal:function(t){new r.Move(t.element,{x:2*n,y:0,duration:2*a,afterFinishInternal:function(t){new r.Move(t.element,{x:-n,y:0,duration:a,afterFinishInternal:function(t){h.setStyle(h.undoPositioned(t.element),u)}})}})}})}})}})}})},i.Effect=r}}()},function(t,e,i){!function(){t.exports=function(t,e){"use strict";var i=t.Class,s=t.$;function o(t,e,i){if(t=s(t),1==arguments.length){var o=t.cumulativeOffset();window.scrollTo(o[0],o[1])}else t.scrollLeft=e,t.scrollTop=i;return t}e.Scroll=i.create(),jQuery.extend(jQuery.extend(e.Scroll.prototype,e.Base.prototype),{currentScrollPos:function(t){return this.element===window?document.viewport.getScrollOffsets():this.element===document.documentElement&&0===document.documentElement.scrollTop&&0===document.documentElement.scrollLeft?{left:document.body.scrollLeft,top:document.body.scrollTop}:{left:this.element.scrollLeft,top:this.element.scrollTop}},initialize:function(t){if(this.element=s(t),!this.element)throw e._elementDoesNotExistError;var i=this.currentScrollPos(t),o=jQuery.extend({x:0,y:0},arguments[1]||{}),n={x:i.left+o.x,y:i.top+o.y};this.start(n)},setup:function(){},update:function(t){var e=this.currentScrollPos(this.element),i=Math.round((this.options.x-e.left)*t+e.left),s=Math.round((this.options.y-e.top)*t+e.top);o(this.element,i,s),this.element===document.documentElement&&o(document.body,i,s)}})}}()},function(t,e,i){!function(){t.exports=function(t,e){"use strict";var i={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|mouse(?:down|up|over|move|out))$/},s={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};e.Event={},e.Event.simulate=function(e,o){var n,r=jQuery.extend(s,arguments[2]||{}),a=null;for(var l in e=t(e),i)if(i[l].test(o)){a=l;break}if(!a)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");return document.createEvent?(n=document.createEvent(a),"HTMLEvents"==a?n.initEvent(o,r.bubbles,r.cancelable):n.initMouseEvent(o,r.bubbles,r.cancelable,document.defaultView,r.button,r.pointerX,r.pointerY,r.pointerX,r.pointerY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,e),e.dispatchEvent(n)):(r.clientX=r.pointerX,r.clientY=r.pointerY,n=jQuery.extend(document.createEventObject(),r),e.fireEvent("on"+o,n)),e}}}()},function(t,e,i){if(void 0===s)var s={};!function(){t.exports=function(t){"use strict";t.Observable={callbacks_:null,notifyObservers:function(t,e,i){null!==this.callbacks_&&(i.field_id=t?t.id:null,setTimeout(function(){var s=this.callbacks_[e];if(void 0!==s){if(null!==t)var o=s[this.lookupKey(t)];for(var n=[o,s.null],r=0,a=n.length;r<a;++r){var l=n[r];if(void 0!==l)for(var h=0,u=l.length;h<u;++h)l[h].call(this,i)}}}.bind(this)))},lookupKey:function(t){return t.name||t.id},storeCallback:function(t,e,i){null===this.callbacks_&&(this.callbacks_={});var s=this.callbacks_[e];void 0===s&&(s={},this.callbacks_[e]=s);var o=s[t];void 0===o&&(o=[],s[t]=o),o.push(i)},removeCallback:function(t,e,i){if(null!==this.callbacks_){var s=this.callbacks_[e];if(void 0!==s){var o=s[t];if(void 0!==o){var n=o.indexOf(i);n>-1&&o.splice(n,1)}}}}}}}()},function(t,e,i){!function(){t.exports=function(t){"use strict";t.ScreenReaderLog=function(t){if(void 0===t){t="reader_log";for(var e=1;document.getElementById(t);)t="reader_log"+ ++e;this.logElement_=document.createElement("div"),this.logElement_.setAttribute("id",t),document.body.appendChild(this.logElement_)}else this.logElement_=document.getElementById(t);this.logElement_.setAttribute("aria-live","assertive"),this.logElement_.setAttribute("aria-relevant","additions"),this.logElement_.setAttribute("role","log"),this.logElement_.setAttribute("class","screen_reader_only")},t.ScreenReaderLog.prototype={add:function(t){var e=document.createElement("p");e.appendChild(document.createTextNode(t)),this.logElement_.appendChild(e)}},t.ScreenReaderLog.add=function(e){this.log_||(this.log_=new t.ScreenReaderLog("reader_log")),this.log_.add(e)}}}()},function(t,e,i){if(void 0===s)var s={};!function(){t.exports=function(t,e,i){"use strict";var s=i.PrototypeAPI.Class;i.RecordDataRequester=s.create();var o={formField_:null,codeField_:null,dataURL_:null,dataReqInput_:null,dataReqOutput_:null,inputFieldsHash_:null,outputFieldsHash_:null,noPriorDataReq_:!0,latestPendingAjaxRequest_:null,lastFieldVal_:null,lastDataHash_:null,outputToSameGroup_:null,autoCompUpdateList_:null,initialize:function(t,e,i,s,o){this.formField_=t,this.dataURL_=e,this.dataReqInput_=i,this.dataReqOutput_=s,this.outputToSameGroup_=o,this.setOutputNamesToRDRNames(t,s)},setOutputNamesToRDRNames:function(t,e){for(var s=i.Autocompleter.getFieldLookupKey(t),o=i.RecordDataRequester.outputFieldNameToRDRFieldName_,n=0,r=e.length;n<r;++n)o[e[n]]=s},dupForField:function(e){return new i.RecordDataRequester(t(e),this.dataURL_,this.dataReqInput_,this.dataReqOutput_,this.outputToSameGroup_)},requestData:function(t){this.noPriorDataReq_=!1,this.inputFieldsHash_||this.initFieldsHash(),this.dataRequestOptions_||(this.dataRequestOptions_={}),t||this.clearDataOutputFields(),this.dataRequestOptions_.complete=e.proxy(t?this.onDataReqCompleteForListData:this.onDataReqComplete,this),this.dataRequestOptions_.data=this.buildParameters(),this.latestPendingAjaxRequest_=e.ajax(this.dataURL_,this.dataRequestOptions_),this.lastFieldVal_=i.Autocompleter.getFieldVal(this.formField_)},assignListData:function(){this.noPriorDataReq_&&""!==i.Autocompleter.getFieldVal(this.formField_)&&this.requestData(!0)},getFieldData:function(t){var e=null;return this.lastDataHash_&&i.Autocompleter.getFieldVal(this.formField_)===this.lastFieldVal_&&(e=this.lastDataHash_[t]),e},onDataReqComplete:function(t){if(this.latestPendingAjaxRequest_===t){this.lastFieldVal_=i.Autocompleter.getFieldVal(this.formField_);var e=t.responseJSON||JSON.parse(t.responseText);this.lastDataHash_=e,this.assignDataToFields(e),this.processUpdateList(e),this.latestPendingAjaxRequest_=null}},onDataReqCompleteForListData:function(t){if(this.latestPendingAjaxRequest_===t){var e=t.responseJSON||JSON.parse(t.responseText);this.lastDataHash_=e,this.assignDataToFields(e,!0),this.processUpdateList(e),this.latestPendingAjaxRequest_=null}},clearDataOutputFields:function(){this.inputFieldsHash_||this.initFieldsHash();for(var t=[],e=this.getOutputFieldsHash(),s=0,o=this.dataReqOutput_.length;s<o;++s){var n=e[this.dataReqOutput_[s]];if(void 0!==n)for(var r=0,a=n.length;r<a;++r){var l=n[r];l.autocomp&&l.autocomp.setListAndField?l.autocomp.setListAndField([]):(i.Autocompleter.setFieldVal(l,"",!1),t.push(l))}}i.Autocompleter.Event.notifyObservers(null,"RDR_CLEARING",t)},addFieldsToUpdateList:function(t,e,i){null===this.autoCompUpdateList_&&(this.autoCompUpdateList_={}),null===this.autoCompUpdateList_[t]&&(this.autoCompUpdateList_[t]={}),null===this.autoCompUpdateList_[t][i]?this.autoCompUpdateList_[t][i]=[e]:this.autoCompUpdateList_[t][i].push(e)},processUpdateList:function(e){if(null!==this.autoCompUpdateList_)for(var s in e){var o=e[s],n=o instanceof Array&&o.length>0;if(null!==this.autoCompUpdateList_[s])for(var r in this.autoCompUpdateList_[s]){var a=r.split(","),l=t(a[0]),h=i.Autocompleter.getFieldVal(l);if("EQ"===a[1]&&h===a[2]||"NE"===a[1]&&h!==a[2])for(var u=this.autoCompUpdateList_[s][r],c=0,d=u.length;c<d;c++)u[c].element&&(n?o[0]instanceof Array?u[c].setListAndField(o[0],o[1]):u[c].setListAndField(o):null===o&&u[c].setListAndField([],[]))}}},initFieldsHash:function(){this.inputFieldsHash_={};var t=i.Autocompleter;if(this.dataReqInput_)for(var e=this.dataReqInput_,s=0,o=e.length;s<o;++s){var n=e[s],r=t.findRelatedFields(this.formField_,n);1===r.length&&(this.inputFieldsHash_[n]=r[0])}this.outputToSameGroup_&&(this.outputFieldsHash_=this.constructOutputFieldsHash())},getOutputFieldsHash:function(){return this.outputToSameGroup_?this.outputFieldsHash_:this.constructOutputFieldsHash()},constructOutputFieldsHash:function(){for(var t={},e=this.dataReqOutput_,s=i.Autocompleter,o=0,n=e.length;o<n;++o){var r=e[o],a=s.findRelatedFields(this.formField_,r);a.length>0&&(t[r]=a)}return t},assignDataToFields:function(t,e){this.inputFieldsHash_||this.initFieldsHash();var s=[],o={},n=this.getOutputFieldsHash(),r=i.Autocompleter;for(var a in t){var l=n[a];if(void 0!==l)for(var h=0,u=l.length;h<u;++h){var c=l[h],d=t[a];if(d instanceof Array){if(null!==c.autocomp){var p=r.getFieldLookupKey(c);if(this.setOutputNamesToRDRNames(this.formField_,[p]),d.length>0&&d[0]instanceof Array?(d[2]&&c.autocomp.initHeadings(d[2]),e?c.autocomp.setList(d[0],d[1]):c.autocomp.setListAndField(d[0],d[1])):e?c.autocomp.setList(d):c.autocomp.setListAndField(d),null!==this.autoCompUpdateList_&&null!==this.autoCompUpdateList_[p]){var q={};q[p]=d,this.processUpdateList(q)}}}else e||(void 0!==c.comboField?c.comboField.mimicField(d,this.formField_.id):(i.Autocompleter.setFieldVal(c,d,!1),s.push(c),o[c.id]=d))}}i.Autocompleter.Event.notifyObservers(null,"RDR_ASSIGNMENT",{updatedFields:s,updatedFieldIDToVal:o,listField:this.formField_})},buildParameters:function(){var t={};this.inputFieldsHash_||this.initFieldsHash();var e=this.formField_.autocomp.getSelectedCodes()[0];if(null!=e?t.code_val=e:t.field_val=i.Autocompleter.getFieldVal(this.formField_),this.dataReqInput_)for(var s=0,o=this.dataReqInput_.length;s<o;++s){var n=this.dataReqInput_[s],r=this.inputFieldsHash_[n];if(null==r)throw"Could not find field for "+n;t[n]=i.Autocompleter.getFieldVal(r)}return t.authenticity_token=window._token||"",t}};e.extend(i.RecordDataRequester.prototype,o),o=null,e.extend(i.RecordDataRequester,{outputFieldNameToRDRFieldName_:{},getOutputFieldRDR:function(e){var s=null,o=t(e),n=i.Autocompleter.getFieldLookupKey(o),r=this.outputFieldNameToRDRFieldName_[n],a=i.Autocompleter.findRelatedFields(o,r);if(1===a.length){var l=a[0].autocomp;l&&(s=l.recDataRequester_)}return s}})}}()},function(t,e,i){if(void 0===s)var s={};!function(){t.exports=function(t,e,i){"use strict";i.FieldAlarms={setOffAlarm:function(t){void 0===this.bonk&&(this.bonk=new Audio(this.soundData_)),this.bonk.readyState>=2&&(this.bonk.currentTime=0,0!==this.bonk.currentTime&&(this.bonk.src=this.bonk.src)),this.bonk.play(),i.Effect.Shake(t.id,5)},cancelAlarm:function(t){t.shakeCanceled=!0,this.bonk.pause(),this.bonk.currentTime=0}}}}()},function(t,e,i){!function(){t.exports=function(t){t.FieldAlarms.soundData_="data:audio/mp3;base64,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qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/44LE/wAAA0gAAAAAqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuOTKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"}}()},function(t,e,i){if(void 0===s)var s={};!function(){t.exports=function(t,e,i){"use strict";var s=i.PrototypeAPI.Browser,o=!!window.attachEvent&&!s.isOpera||"undefined"!=typeof navigator&&navigator.userAgent.indexOf("Trident")>=0;i.Autocompleter={isIE:o,currentAutoCompField_:-1,USE_STATISTICS:2,NO_COMPLETION_SUGGESTIONS:0,SUGGEST_SHORTEST:1,LIST_ITEM_FIELD_SEP:" - ",screenReaderLog_:new i.ScreenReaderLog,setOptions:function(t){e.extend(this,t)},getFieldVal:function(t){return t.value},setFieldVal:function(t,e,s){var o;t.autocomp?t.autocomp.setFieldVal(e,s):(void 0===s&&(s=!0),s&&(o=this.getFieldVal(t)),t.value=e,s&&o!==e&&i.Event.simulate(t,"change"))},getFieldLookupKey:i.Observable.lookupKey,lookupFields:function(t){for(var e=[],i=0,s=document.forms.length;i<s;++i){var o=document.forms[i].elements[t];void 0!==o&&e.push(o)}return e},findRelatedFields:function(t,e){return this.lookupFields(e)},getFieldLabel:function(t){return null},listItemElementContainer:function(){var t=e("#completionOptions")[0].firstChild;return t&&"TABLE"===t.tagName&&(t=t.tBodies[0]),t},listItemElements:function(){var t=null,e=this.listItemElementContainer();return e&&(t=e.childNodes),t},setOffAlarm:function(t){i.FieldAlarms.setOffAlarm(t)},cancelAlarm:function(t){i.FieldAlarms.cancelAlarm(t)},stopEvent:function(t){t.stopImmediatePropagation(),t.preventDefault()},screenReaderLog:function(t){i.Autocompleter.screenReaderLog_.add(t)},createDOMCache:function(t,e){var i={data:{},get:function(t){var e=this.data[t];return void 0===e&&(e=this.data[t]=this.refresh[t].apply(this)),e},set:function(t,e){this.data[t]=e},invalidate:function(t){t?delete this.data[t]:this.data={}},refresh:{}};return Object.assign(i,t),Object.assign(i.refresh,e),i}},i.Autocompleter.Base=function(){},e.extend(i.Autocompleter.Base,{MAX_ITEMS_BELOW_FIELD:7,classInit_:!1,classInit:function(){this.classInit_||(e(document.body).append('<div id="searchResults" class="form_auto_complete">              <div id="completionOptionsScroller">             <span class="auto_complete" id="completionOptions"></span>              </div>              <div id="moreResults">See more items (Ctl Ret)</div>              <div id="searchCount">Search Results\x3c!-- place holder for result count,               needed for height calculation--\x3e</div>              <div id="searchHint">Search Hint\x3c!--place holder--\x3e</div>              </div>'),e("#moreResults").mousedown(function(e){var s=t(i.Autocompleter.currentAutoCompField_);s.autocomp.handleSeeMoreItems(e),i.Autocompleter.Event.notifyObservers(s,"LIST_EXP",{list_expansion_method:"clicked"})}),e("#completionOptionsScroller").mousedown(e.proxy(function(e){if(i.Autocompleter.isIE&&"completionOptionsScroller"===e.target.id&&(i.Autocompleter.stopEvent(e),i.Autocompleter.completionOptionsScrollerClicked_=!0,-1!=t(i.Autocompleter.currentAutoCompField_))){var s=t(i.Autocompleter.currentAutoCompField_);setTimeout(function(){s.focus()})}},this)),this.classInit_=!0)},noCaseSort:function(t,e){var i=t.toLowerCase(),s=e.toLowerCase();return i>s?1:i<s?-1:0},escapeAttribute:i.PrototypeAPI.escapeAttribute,unescapeAttribute:function(t){return t.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")}}),i.Autocompleter.sharedDOMCache=i.Autocompleter.createDOMCache({},{spacerDiv:function(){var e=t("spacer");return e||(e=document.createElement("div"),e.setAttribute("id","spacer"),document.body.appendChild(e)),e},listContainer:function(){return t("searchResults")},firstEntryWidth:function(){return i.Autocompleter.listItemElements()[0].offsetWidth},listBoundingRect:function(){return this.get("listContainer").getBoundingClientRect()},viewPortWidth:function(){return document.documentElement.clientWidth},spacerCoords:function(){return this.get("spacerDiv").getBoundingClientRect()}});var n={constructorOpts_:null,scoreField_:null,scoreFieldInitialized_:!1,itemToDataIndex_:null,selectedCodes_:null,selectedItems_:null,selectedItemData_:null,matchListValue_:null,invalidStatus_:!1,matchStatus_:!0,focusInProgress_:!1,refocusInProgress_:!1,listBelowField_:!0,listContainer:null,recDataRequester_:null,enabled_:!0,preFieldFillVal_:null,fieldValIsListVal_:null,indexToHeadingLevel_:{},suggestionMode_:i.Autocompleter.SUGGEST_SHORTEST,lastScrollEffect_:null,multiSelect_:!1,listExtraData_:null,processedFieldVal_:null,defAutocompleterBaseInit:function(s,o){o||(o={}),o.wordBoundaryChars&&(o.tokens=o.wordBoundaryChars),void 0!==o.suggestionMode&&(this.suggestionMode_=o.suggestionMode),this.twoColumnFlow_=o.twoColumnFlow,void 0===this.twoColumnFlow_&&(this.twoColumnFlow_=!0),o.tokens||void 0===o.maxSelect?o.maxSelect=1:"*"===o.maxSelect&&(o.maxSelect=1/0),this.multiSelect_=1!==o.maxSelect,void 0!==o.scrolledContainer?this.scrolledContainer_=o.scrolledContainer:this.scrolledContainer_=document.documentElement,void 0===(this.nonMatchSuggestions_=o.nonMatchSuggestions)&&(this.nonMatchSuggestions_=!1),this.constructorOpts_=o,this.selectedCodes_={},this.selectedItems_={},this.selectedItemData_=[];var n=o.dataRequester;if(i.Autocompleter.Base.classInit_||i.Autocompleter.Base.classInit(),this.matchListValue_=o.matchListValue||!1,this.recDataRequester_=n,this.update=t("completionOptions"),this.options=o,this.options.frequency=this.options.frequency||.01,this.options.minChars=this.options.minChars||1,this.element="string"==typeof s?t(s):s,!this.element)throw"string"==typeof s?new Error("Could not find the field with id '"+s+'"'):new Error("The autocompleter constructor requires an field element or an ID");this.ensureNeededAttrs(),this.hasFocus=!1,this.changed=!1,this.active=!1,this.index=0,this.entryCount=0,this.observer=null,this.element.setAttribute("autocomplete","off"),e(this.update).hide();var r=e(this.element);if(r.blur(e.proxy(this.onBlur,this)),r.keydown(e.proxy(this.onKeyPress,this)),this.options.tokens&&r.click(function(){this.tokenBounds=null,this.getTokenBounds(this.element.selectionStart)}.bind(this)),o.maxSelect>1){var a=e('<span class="autocomp_selected"><ul></ul></span>')[0];this.element.parentNode.replaceChild(a,this.element),a.appendChild(this.element),this.selectedList=a.firstChild}this.element.setAttribute("role","combobox"),this.element.setAttribute("aria-expanded","false"),this.onMouseDownListener=e.proxy(this.onMouseDown,this),e(this.element).change(e.proxy(this.onChange,this)),e(this.element).keypress(e.proxy(this.changeToFieldByKeys,this));var l=e.proxy(function(){this.typedSinceLastFocus_=!0},this);e(this.element).bind("paste cut",l),this.listContainer=i.Autocompleter.sharedDOMCache.get("listContainer"),this.options.showList=e.proxy(this.showList,this),this.options.hideList=e.proxy(this.hideList,this),this.options.posAnsList=e.proxy(this.posAnsList,this),this.update.style.display="block",this.element.autocomp=this,this.index=-1,this.initDOMCache(),this.oldElementValue=this.domCache.get("elemVal")},setFieldVal:function(t,e){var s;void 0===e&&(e=!0),e&&(s=this.domCache.get("elemVal")),this.domCache.set("elemVal",this.element.value=this.oldElementValue=t),this.tokenBounds=null,e&&s!==t&&i.Event.simulate(this.element,"change")},ensureNeededAttrs:function(){var t=this.element;""===t.id&&(i.Autocompleter.lastGeneratedID_||(i.Autocompleter.lastGeneratedID_=0),t.id="ac"+ ++i.Autocompleter.lastGeneratedID_)},dupDataReqForField:function(t){var e=null;return this.recDataRequester_&&(e=this.recDataRequester_.dupForField(t)),e},getSelectedCodes:function(){for(var t=this.getSelectedItems(),e=[],i=0,s=t.length;i<s;++i)e.push(this.selectedCodes_[t[i]]);return e},getSelectedItems:function(){return Object.keys(this.selectedItems_)},getSelectedItemData:function(){return this.selectedItemData_.length>0?this.selectedItemData_:null},storeSelectedItem:function(t,e){if(void 0===t&&(t=this.domCache.get("elemVal"),e=this.getItemCode(t)),this.multiSelect_||(this.selectedCodes_={},this.selectedItems_={},this.selectedItemData_=[]),t){var i,s=null!=e;s&&(this.selectedCodes_[t]=e),this.selectedItems_[t]=1,this.getItemData?i=this.getItemData(t):(i={text:t},s&&(i.code=e)),this.selectedItemData_.push(i)}},getItemCode:function(t){this.itemToDataIndex_||this.initItemToDataIndex();var e=this.itemToDataIndex_[t],i=null;return void 0!==e&&this.itemCodes_&&(i=this.itemCodes_[e]),i},addToSelectedArea:function(t){var s=i.Autocompleter.Base.escapeAttribute(t),o=e('<li><button type="button" alt="'+s+'"><span aria-hidden="true">&times;</span></button>'+s+"</li>")[0];this.selectedList.appendChild(o);var n=o.childNodes[0];return e(n).click(e.proxy(this.removeSelection,this)),s},moveEntryToSelectedArea:function(){var t=this.addToSelectedArea(this.domCache.get("elemVal"));if(this.setFieldVal(this.processedFieldVal_="",!1),i.Autocompleter.screenReaderLog("Selected "+t),this.index>=0){var e=i.Autocompleter.listItemElementContainer();e.removeChild(this.getCurrentEntry()),--this.entryCount;for(var s=e.childNodes,o=this.index,n=s.length;o<n;++o)s[o].autocompleteIndex=o;if(this.index==this.entryCount&&--this.index,this.numHeadings_){for(var r=this.index;this.index<this.entryCount&&this.liIsHeading(this.getCurrentEntry());)++this.index;if(this.index==this.entryCount)for(this.index=r-1;this.index>0&&this.liIsHeading(this.getCurrentEntry());)--this.index}this.render()}this.active=!0,this.hasFocus=!0,this.posAnsList()},removeSelection:function(t){var e=t.target.parentNode;"SPAN"===t.target.tagName&&(e=e.parentNode),e.parentNode.removeChild(e);var s=e.childNodes[1].textContent;delete this.selectedCodes_[s],delete this.selectedItems_[s];for(var o=0,n=this.selectedItemData_.length;o<n;++o)if(this.selectedItemData_[o].text===s){this.selectedItemData_.splice(o,1);break}this.listSelectionNotification(s,!0,!0),i.Autocompleter.screenReaderLog("Unselected "+s)},isSelected:function(t){return this.selectedItems_&&void 0!==this.selectedItems_[t]},getScoreField:function(){return this.scoreFieldInitialized_||(this.scoreField_=i.Autocompleter.getScoreField(this.element),this.scoreField_&&(this.scoreFieldInitialized_=!0)),this.scoreField_},changeToFieldByKeys:function(t){if(!this.typedSinceLastFocus_){var e=!1;void 0===t.which?e=!0:"number"==typeof t.which&&t.which>0&&(e=!t.ctrlKey&&!t.metaKey&&!t.altKey&&8!==t.which),this.typedSinceLastFocus_=e}},addObservers:function(t){e(t).mousedown(this.onMouseDownListener)},listItemValue:function(t){return this.options.tableFormat?t.getAttribute("data-fieldval"):t.textContent},markPrevious:function(){null===this.preFieldFillVal_&&(this.preFieldFillVal_=this.domCache.get("elemVal"));var t,e=this.index;-1===e&&(e=this.entryCount-1);do{this.index>0?this.index--:this.index=this.entryCount-1,t=this.getCurrentEntry();var s=this.listItemValue(t);this.itemTextIsHeading(s)&&(i.Autocompleter.screenReaderLog("Above list heading: "+s),t=null)}while(!t&&this.index!==e);t&&(this.scrollToShow(t,this.update.parentNode),this.updateElementAfterMarking(t))},markNext:function(){null===this.preFieldFillVal_&&(this.preFieldFillVal_=this.domCache.get("elemVal"));var t,e=this.index;-1===e&&(e=this.entryCount-1);do{this.index<this.entryCount-1?this.index++:this.index=0,t=this.getCurrentEntry();var s=this.listItemValue(t);this.itemTextIsHeading(s)&&(i.Autocompleter.screenReaderLog("Under list heading: "+s),t=null)}while(!t&&this.index!==e);t&&(this.scrollToShow(t,this.update.parentNode),this.updateElementAfterMarking(t))},updateElementAfterMarking:function(t){var s=this.tokenBounds;if(this.updateElement(t),this.options.tokens?(this.getTokenBounds(s&&s[0]),this.element.setSelectionRange(this.tokenBounds[0],this.tokenBounds[1])):this.element.select(),this.options.tableFormat){var o=[],n=e(t).children("td");if(n.length>1){for(var r=0,a=n.length;r<a;++r)o.push(n[r].innerText);i.Autocompleter.screenReaderLog(o.join("; "))}}},hideList:function(){i.Autocompleter.currentAutoCompField_===this.element.id&&("visible"!==this.listContainer.style.visibility||(this.listContainer.style.visibility="hidden",this.listShowing=!1,this.listContainer.setAttribute("aria-hidden","true"),this.element.setAttribute("aria-expanded","false")))},showList:function(){var t="visible"!==this.listContainer.style.visibility;this.listContainer.style.visibility="visible",this.listShowing=!0,this.listContainer.setAttribute("aria-hidden","false"),this.element.setAttribute("aria-expanded","true"),t&&!this.temporaryHide_&&this.entryCount>0&&(i.Autocompleter.screenReaderLog("A list has appeared below the "+this.getFieldName()+"."),this.options.tableFormat&&this.options.colHeaders&&i.Autocompleter.screenReaderLog("The column headers on the multi-column list are "+this.options.colHeaders.join("; ")))},getFieldName:function(){if(void 0===this.fieldName_){var t=i.Autocompleter.getFieldLabel(this.element.id);this.fieldName_=null===t?"field":'field "'+t+'"'}return this.fieldName_},scrollToShow:function(t,e){if(t.offsetTop<e.scrollTop)e.scrollTop=t.offsetTop;else{var i=t.clientHeight,s=e.clientHeight;t.offsetTop+i-e.scrollTop>s&&(e.scrollTop=t.offsetTop+i-s)}},pageOptionsUpOrDown:function(t){var i,s=e("#completionOptionsScroller")[0],o=s.clientHeight;if(t)s.scrollTop>0&&((i=s.scrollTop-o)<0&&(i=0),s.scrollTop=i);else{var n=e("#completionOptions")[0].clientHeight-o;n<0&&(n=0),s.scrollTop<n&&((i=s.scrollTop+o)>n&&(i=n),s.scrollTop=i)}},isSearchKey:function(t){return t.ctrlKey&&t.keyCode===e.ui.keyCode.ENTER},onKeyPress:function(t){if(this.enabled_){var s=t.keyCode,o=!0;if(this.fieldEventIsBigList(t))t.stopImmediatePropagation(),this.preFieldFillVal_&&this.setFieldVal(this.preFieldFillVal_,!1),this.handleSeeMoreItems(t),i.Autocompleter.Event.notifyObservers(this.element,"LIST_EXP",{list_expansion_method:"CtrlRet"});else{var n=e.ui.keyCode;switch(s){case n.ENTER:this.multiSelect_&&i.Autocompleter.stopEvent(t),this.handleDataEntry(t);break;case n.TAB:""!==this.domCache.get("elemVal")&&this.handleDataEntry(t);break;case n.ESCAPE:null!==this.preFieldFillVal_&&(this.setFieldVal(this.preFieldFillVal_,!1),i.Autocompleter.Event.notifyObservers(this.element,"CANCEL",{restored_value:this.preFieldFillVal_})),this.active&&(this.index=-1,this.hide(),this.active=!1);break;default:if(this.active)switch(s){case n.PAGE_UP:this.pageOptionsUpOrDown(!0);break;case n.PAGE_DOWN:this.pageOptionsUpOrDown(!1);break;default:if(t.ctrlKey)o=!1;else switch(s){case n.DOWN:case n.UP:s===n.UP?this.markPrevious():this.markNext(),this.render(),i.Autocompleter.stopEvent(t);break;case n.LEFT:case n.RIGHT:this.options.tokens&&(this.tokenBounds=null,this.getTokenBounds()),!t.ctrlKey&&this.index>=0&&e(this.update).hasClass("multi_col")&&this.moveToOtherColumn(t);break;default:o=!1}}else o=!1}}o||t.ctrlKey&&86!==s||16===s||17===s||0===s||(this.preFieldFillVal_=null,this.changed=!0,this.hasFocus=!0,this.matchListItemsToField_=!0,this.observer&&clearTimeout(this.observer),this.observer=setTimeout(e.proxy(this.onObserverEvent,this),1e3*this.options.frequency))}},setMatchStatusIndicator:function(t){t!==this.matchStatus_&&(t?e(this.element).hasClass("no_match")&&(e(this.element).removeClass("no_match"),i.Autocompleter.screenReaderLog("The field no longer contains a non-matching value.")):(e(this.element).addClass("no_match"),i.Autocompleter.screenReaderLog("The field's value does not match any items in the list.")),this.matchStatus_=t)},setInvalidValIndicator:function(t){t?(i.Autocompleter.setOffAlarm(this.element),this.invalidStatus_||(e(this.element).addClass("invalid"),this.element.setAttribute("invalid",!0))):this.invalidStatus_&&(e(this.element).removeClass("invalid"),this.element.setAttribute("invalid",!1)),this.invalidStatus_=t},cancelInvalidValIndicator:function(){i.Autocompleter.cancelAlarm(this.element)},updateChoices:function(t,s){if(this.index=-1,!this.changed&&this.hasFocus){this.update.innerHTML=t;var o=this.update.firstChild;o&&o.tHead&&e(o.tHead).mousedown(function(t){i.Autocompleter.stopEvent(t)});var n=i.Autocompleter.listItemElements();if(n){var r;if(this.entryCount=n.length,this.suggestionMode_!==i.Autocompleter.NO_COMPLETION_SUGGESTIONS&&this.entryCount>0&&!this.focusInProgress_&&s){for(r=0;this.liIsHeading(n[r])&&r<this.entryCount;++r);this.index=r}for(r=0;r<this.entryCount;r++){var a=this.getEntry(r);a.autocompleteIndex=r,this.addObservers(a)}}else this.entryCount=0;1===this.entryCount&&this.options.autoSelect?(this.selectEntry(),this.hide()):this.render(),this.focusInProgress_||this.setMatchStatusIndicator(this.entryCount>0||""===this.trimmedElemVal)}},pickedByNumber:function(){return this.add_seqnum&&this.trimmedElemVal.match(/^\d+$/)},pickBestMatch:function(t){var e=this.trimmedElemVal.toLowerCase(),i=t.length,s=-1;if(e.length>0&&i>0){for(var o=-1,n=1/0,r=-1,a=n,l=-1,h=n,u=0;u<i;++u){var c=t[u];if(!this.itemTextIsHeading(c)){var d=c.toLowerCase(),p=(d=d.replace(/^\W+/,"")).indexOf(e),q=c.length;0===p?/(^\d+$)/.test(e)?(r=0,a=0):q<a&&(r=u,a=q):-1===r&&(p>0?q<h&&(l=u,h=q):-1===l&&q<n&&(n=q,o=u))}}s=r>-1?r:l>-1?l:o}return s},posAnsList:function(){this.posListBelowFieldInMultiCol(),this.index>0&&this.scrollToShow(this.getCurrentEntry(),t("completionOptionsScroller"))},posListBelowFieldInMultiCol:function(){var e=i.Autocompleter.sharedDOMCache,s=this.domCache.element,o=this.update;this.domCache.invalidate("elemPos"),e.invalidate("firstEntryWidth"),e.invalidate("listBoundingRect"),e.invalidate("viewPortWidth"),o.style.height&&(o.style.height=""),this.setListWrap(!1),o.style.width="auto",t("completionOptionsScroller").style.height="",this.listContainer.style.width="",this.listHeight=void 0;var n=this.listContainer;n.style.display="none";var r=this.domCache.get("elemPos");n.style.display="",n.style.top=r.top+s.offsetHeight+"px";var a=this.scrolledContainer_,l=document.documentElement.clientHeight,h=l,u=(C=e.get("listBoundingRect")).bottom;if(u<=h)this.setListLeft();else{var c=this.twoColumnFlow_&&!this.options.tableFormat&&this.entryCount>4;if(c&&(c=this.setListWrap(!0))&&(u=e.get("listBoundingRect").bottom),c&&u<=h)this.setListLeft();else{var d=s.getBoundingClientRect(),p=void 0;if(a){this.lastScrollEffect_&&this.lastScrollEffect_.cancel();var q,m=u-h,f=d.top,A=0,g=this.constructorOpts_.headerBar;if(g){var v=document.getElementById(g);v&&(A=v.offsetHeight)}var _=a.getBoundingClientRect().top;m>(q=_>A?f-_:f-A)&&(m=q,p=l-d.height-A),u=void 0===p?e.get("listBoundingRect").bottom:e.get("listBoundingRect").top+p;var y=e.get("spacerCoords");u>y.bottom&&(e.get("spacerDiv").style.height=u-y.top+"px",e.invalidate("spacerCoords")),this.lastScrollEffect_=new i.Effect.Scroll(a,{y:m,duration:.4})}else p=window.innerHeight-d.bottom;if(void 0!==p){this.setListHeight(p);var S=e.get("viewPortWidth"),C=e.get("listBoundingRect");e.listWrap&&C.width>S&&this.setListWrap(!1)}this.setListLeft()}}},initDOMCache:function(){var t=this,s=i.Autocompleter;this.domCache=s.createDOMCache({element:t.listPositioningElem()},{elemPos:function(){return e(this.element).offset()},elemVal:function(){return s.getFieldVal(t.element)}})},listPositioningElem:function(){return this.multiSelect_?this.element.parentNode:this.element},setListWrap:function(t){var s=i.Autocompleter.sharedDOMCache;if(t!==s.listWrap){if(t){var o=2*s.get("firstEntryWidth")+4;o<=s.get("viewPortWidth")&&(this.listContainer.style.width=o+"px",e(this.update).addClass("multi_col"),s.listWrap=!0)}else e(this.update).removeClass("multi_col"),this.listContainer.style.width="",s.listWrap=!1,s.invalidate("viewPortWidth");s.invalidate("listBoundingRect"),this.domCache.invalidate("elemPos")}return s.listWrap},setListLeft:function(){var t=this.listContainer,e=i.Autocompleter.sharedDOMCache,s=e.get("viewPortWidth"),o=e.get("listBoundingRect"),n=this.domCache.get("elemPos"),r=o.width-(s-n.left);r<0&&(r=0);var a=n.left-r;a<0&&(a=0);var l=i.Autocompleter.sharedDOMCache;l.listPosLeft!==a&&(t.style.left=a+"px",l.listPosLeft=a)},setListHeight:function(e){var s=i.Autocompleter.sharedDOMCache,o=s.get("listBoundingRect");e=e-o.height+this.update.offsetHeight,this.listContainer.style.width=o.width+20+"px",e>=20&&(t("completionOptionsScroller").style.height=e+"px",s.invalidate("listBoundingRect"))},getToken:function(){var t=this.domCache.get("elemVal");if(this.options.tokens){var e=this.getTokenBounds();t=t.substring(e[0],e[1])}return t},getTokenBounds:function(t){if(null!=this.tokenBounds)return this.tokenBounds;var e=this.domCache.get("elemVal");if(""===e.trim())return[-1,0];for(var i,s=void 0!==t?t:this.element.selectionStart,o=s==this.oldElementValue.length?1:0,n=-1,r=e.length,a=0,l=this.options.tokens.length;a<l;++a)(i=e.lastIndexOf(this.options.tokens[a],s+o-1))>n&&(n=i),-1!=(i=e.indexOf(this.options.tokens[a],s+o))&&i<r&&(r=i);return this.tokenBounds=[n+1,r]},dupForField:function(t){throw"dupForField must be overridden by autocompleter subclasses."},initItemToDataIndex:function(){throw"initItemToDataIndex must be overridden by autocompleter classes that need it"},propagateFieldChanges:function(t){void 0===t&&(t=this.matchStatus_),this.recDataRequester_&&(t&&""!==this.domCache.get("elemVal").trim()?this.recDataRequester_.requestData():this.recDataRequester_.clearDataOutputFields())},getValTyped:function(){return null===this.preFieldFillVal_?this.domCache.get("elemVal"):this.preFieldFillVal_},listSelectionNotification:function(t,e,s){var o;void 0===s?s=!1:s&&(o=t,t=""),void 0===o&&(o=this.domCache.get("elemVal"));var n=this.clickSelectionInProgress_?"clicked":null===this.preFieldFillVal_?"typed":"arrows",r="typed"!==n&&e,a=this.getItemCode(o);i.Autocompleter.Event.notifyObservers(this.element,"LIST_SEL",{input_method:n,val_typed_in:t,final_val:o,used_list:r,list:this.rawList_,on_list:e,item_code:a,removed:s})},attemptSelection:function(){var t=!1,e=this.getValTyped();if(this.active){if(-1===this.index){for(var s=this.domCache.get("elemVal").trim(),o=s.toLowerCase(),n=-1,r=-1,a=0;a<this.entryCount&&n<0;++a){var l=this.getEntry(a),h=this.listItemValue(l);this.liIsHeading(l)||(s===h?n=a:r<0&&o===h.toLowerCase()&&(r=a))}n>=0?(this.index=n,t=!0):r>=0&&(this.index=r,t=!0)}else t=this.entryCount>0&&!this.liIsHeading(this.getCurrentEntry());this.fieldValIsListVal_=t,t&&(this.active=!1,this.updateElement(this.getCurrentEntry()),this.storeSelectedItem(),null!==i.Autocompleter.Event.callbacks_&&this.listSelectionNotification(e,!0),this.processedFieldVal_=i.Autocompleter.getFieldVal(this.element),this.setMatchStatusIndicator(!0),this.setInvalidValIndicator(!1),this.propagateFieldChanges(),this.multiSelect_&&this.moveEntryToSelectedArea()),this.multiSelect_||(this.active=!1,this.hide())}return t},selectEntry:function(){this.attemptSelection()},handleNonListEntry:function(){this.propagateFieldChanges(!1),this.multiSelect_||(this.selectedCodes_={},this.selectedItems_={});var t=i.Autocompleter.getFieldVal(this.element);""===i.Autocompleter.getFieldVal(this.element)?(this.setMatchStatusIndicator(!0),this.setInvalidValIndicator(!1),this.storeSelectedItem(""),null!==i.Autocompleter.Event.callbacks_&&this.listSelectionNotification("",!1),this.processedFieldVal_=t):(this.enabled_&&this.setMatchStatusIndicator(!1),null!==i.Autocompleter.Event.callbacks_&&this.listSelectionNotification(this.getValTyped(),!1),this.matchListValue_?(i.Autocompleter.screenReaderLog("For this field your entry must match an item from the suggestion list."),this.setInvalidValIndicator(!0),this.refocusInProgress_=!0,this.processedFieldVal_=t,setTimeout(e.proxy(function(){this.element.focus(),this.element.select(),this.refocusInProgress_=!1},this))):(this.storeSelectedItem(),this.multiSelect_?this.moveEntryToSelectedArea():this.processedFieldVal_=t,this.findSuggestions&&this.nonMatchSuggestions_&&!this.multiSelect_&&setTimeout(e.proxy(function(){this.findSuggestions()},this))))},onChange:function(t){this.domCache.invalidate("elemVal"),i.Autocompleter.completionOptionsScrollerClicked_||this.handleDataEntry(t)},onBlur:function(t){i.Autocompleter.completionOptionsScrollerClicked_||(this.lastScrollEffect_&&this.lastScrollEffect_.cancel(),i.Autocompleter.getFieldVal(this.element)!==this.processedFieldVal_&&i.Event.simulate(this.element,"change"),this.enabled_&&!this.refocusInProgress_&&(this.hide(),this.hasFocus=!1,this.active=!1,this.invalidStatus_?this.clearInvalidFieldVal():""===i.Autocompleter.getFieldVal(this.element)?this.setMatchStatusIndicator(!0):!1===this.fieldValIsListVal_&&this.setMatchStatusIndicator(!1)))},clearInvalidFieldVal:function(){this.setFieldVal("",!1),this.setInvalidValIndicator(!1),this.setMatchStatusIndicator(!0),this.listSelectionNotification("",!1),this.processedFieldVal_=""},onFocus:function(t){if(i.Autocompleter.currentAutoCompField_=this.element.id,this.refocusInProgress_||(this.processedFieldVal_=i.Autocompleter.getFieldVal(this.element)),this.refocusInProgress_=!1,this.preFieldFillVal_=null,i.Autocompleter.Event.notifyObservers(this.element,"FOCUS",{start_val:this.processedFieldVal_}),this.multiSelect_){var e=Object.getOwnPropertyNames(this.selectedItems_);if(e.length>0){var s="Above this multi-select field are deselection buttons for each selected item.  Currently selected:"+e.join(", ");i.Autocompleter.screenReaderLog(s)}}},onMouseDown:function(t){i.Autocompleter.stopEvent(t);for(var e=t.target;e&&void 0===e.autocompleteIndex;)e=e.parentNode;e&&!this.liIsHeading(e)&&(this.clickSelectionInProgress_=!0,this.index=e.autocompleteIndex,this.selectEntry(),this.hide(),this.clickSelectionInProgress_=!1,this.multiSelect_&&this.showList()),this.tokenBounds=null},handleDataEntry:function(t){if(this.invalidStatus_&&this.processedFieldVal_===this.domCache.get("elemVal"))this.clearInvalidFieldVal();else{this.observer&&clearTimeout(this.observer);var e=i.Autocompleter.getFieldVal(this.element),s=!1;this.processedFieldVal_!==e&&""!==e?s=this.attemptSelection():this.multiSelect_&&""===e&&this.index>=0&&(s=this.attemptSelection()),this.processedFieldVal_===e||s||(""===e&&(this.fieldValIsListVal_=!1),this.handleNonListEntry()),this.multiSelect_||(this.hide(),this.active=!1),!t.stopped&&this.matchListValue_&&this.invalidStatus_&&i.Autocompleter.stopEvent(t)}},itemTextIsHeading:function(t){var e=!!this.numHeadings_;if(e){this.itemToDataIndex_||this.initItemToDataIndex();var i=this.itemToDataIndex_[t];e=void 0!==i&&!!this.indexToHeadingLevel_[i]}return e},liIsHeading:function(t){var e=!!this.numHeadings_;return e&&(e=this.itemTextIsHeading(this.listItemValue(t))),e},onShow:function(t,e){t.autocomp.showList()},onHide:function(t,e){t.autocomp.hideList()},moveToOtherColumn:function(t){var e=i.Autocompleter.listItemElements().length,s=Math.floor(e/2),o=Math.ceil(e/2),n=this.index;if(this.index<s?n=this.index+o:this.index>=o&&(n=this.index-o),n!==this.index){var r=this.getEntry(n);this.liIsHeading(r)||(this.index=n,this.setFieldVal(this.listItemValue(r),!1),this.element.select(),this.render(),i.Autocompleter.stopEvent(t))}},handleSeeMoreItems:function(t){},readSearchCount:function(){var e=!1;return"none"!==t("searchCount").style.display&&(i.Autocompleter.screenReaderLog("Showing "+t("searchCount").innerHTML+"."),"none"!==t("moreResults").style.display&&i.Autocompleter.screenReaderLog("Pressing control+return will expand the list."),e=!0),e},destroy:function(){this.stopObservingEvents(),this.detachFromDOM()},stopObservingEvents:function(){e(this.element).unbind()},detachFromDOM:function(){this.element.autocomp=null,this.element=null,this.update=null,this.listContainer=null,this.recDataRequester_=null},updateElement:function(t){var e=this.listItemValue(t),i=e;if(this.options.tokens){var s=this.getTokenBounds();if(-1!=s[0]){var o=this.domCache.get("elemVal"),n=o.substr(0,s[0]),r=o.substr(s[0]).match(/^\s+/);r&&(n+=r[0]),i=n+e+o.substr(s[1])}}this.setFieldVal(i,!1),this.options.afterUpdateElement&&this.options.afterUpdateElement(this.element,t)},show:function(){"none"==e(this.update).css("display")&&this.options.onShow(this.element,this.update),!this.iefix&&s.IE&&"absolute"==e(this.update).css("position")&&(new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>'),this.iefix=t(this.update.id+"_iefix")),this.iefix&&setTimeout(e.proxy(this.fixIEOverlapping,this),50)},fixIEOverlapping:function(){var t=this.update.offset();this.iefix.style.left=t.left,this.update.style.height||(this.update.style.top=t.top),this.iefix.style.zIndex=1,this.update.style.zIndex=2,e(this.iefix).show()},hide:function(){"none"!=e(this.update).css("display")&&this.options.onHide(this.element,this.update),this.iefix&&e(this.iefix).hide()},render:function(){if(this.entryCount>0){for(var t=0;t<this.entryCount;t++)this.index==t?e(this.getEntry(t)).addClass("selected"):e(this.getEntry(t)).removeClass("selected");this.hasFocus&&(this.show(),this.active=!0)}else this.active=!1,this.hide()},getEntry:function(t){return i.Autocompleter.listItemElements()[t]},getCurrentEntry:function(){return this.getEntry(this.index)},onObserverEvent:function(){this.domCache.invalidate("elemVal"),this.changed=!1,this.tokenBounds=null,this.getToken().length>=this.options.minChars?this.getUpdatedChoices():(this.active=!1,this.hide()),this.oldElementValue=this.domCache.get("elemVal")}};e.extend(i.Autocompleter.Base.prototype,n),n=null}}()},function(t,e,i){!function(){t.exports=function(t,e,i){"use strict";var s=i.PrototypeAPI.Class,o=i.PrototypeAPI.Browser;i.Autocompleter.Prefetch=s.create(),i.Autocompleter.Prefetch.constructor=i.Autocompleter.Prefetch,e.extend(i.Autocompleter.Prefetch.prototype,i.Autocompleter.Base.prototype),i.Autocompleter.Prefetch.prototype.className="Def.Autocompleter.Prefetch";var n={SEQ_NUM_PREFIX:'<span class="listNum">',SEQ_NUM_SEPARATOR:":</span>&nbsp; ",validationFailed_:!1,listIsOriginal_:!0,rawList_:null,itemCodes_:null,listLoadAttempted_:!1,seeMoreItemsClicked_:!1,matchListItemsToField_:!1,defaultSelectionIndex_:null,autoFill_:!0,initialize:function(t,s,o){var n=(o=e.extend({ignoreCase:!0,fullSearch:!1,selector:this.selector,onShow:this.onShow,onHide:this.onHide},o||{})).addSeqNum;this.add_seqnum=void 0===n||n;var r=o.autoFill;void 0!==r&&(this.autoFill_=r),i.Autocompleter.Base.classInit_||i.Autocompleter.Base.classInit(),this.initHeadings(o),this.defAutocompleterBaseInit(t,o),e(this.element).focus(e.proxy(this.onFocus,this)),e(this.element).click(e.proxy(this.onFieldClick,this));var a=o.codes;this.setList(s,a),this.listIsOriginal_=!0,this.originalCodes_=a,this.options.minChars=0,this.splitAutocomp_=!1,e(this.element).addClass("ansList")},getUpdatedChoices:function(){this.trimmedElemVal=this.domCache.get("elemVal").trim(),this.updateChoices(this.options.selector(this),this.pickedByNumber())},dupItemToDataIndex:function(t){this.listIsOriginal_&&(this.itemToDataIndex_||this.initItemToDataIndex(),t.itemToDataIndex_=this.itemToDataIndex_)},dupForField:function(t){var s=this.dupDataReqForField(t),o={};e.extend(!0,o,this.constructorOpts_),o.dataRequester=s;var n=new i.Autocompleter.Prefetch(t,this.rawList_,o);return this.dupItemToDataIndex(n),n},initHeadings:function(t){var e=t.codes,i=t.itemToHeading;if(i){t.itemToHeading=null;for(var s={},o={},n=0,r=e.length;n<r;++n){var a=i[e[n]];if(a){var l=s[a];if(!l){var h=i[a];l=h?s[h]+1:1,s[a]=l}}}for(n=0,r=e.length;n<r;++n)l=s[e[n]],o[n]=l||0;this.indexToHeadingLevel_=o,t.indexToHeadingLevel=o,this.numHeadings_=Object.keys(s).length,t.numHeadings=this.numHeadings_}else t.indexToHeadingLevel&&(this.indexToHeadingLevel_=t.indexToHeadingLevel,this.numHeadings_=t.numHeadings)},initItemToDataIndex:function(){if(this.itemToDataIndex_={},this.rawList_)for(var t=0,e=this.rawList_.length;t<e;++t)this.itemToDataIndex_[this.rawList_[t]]=t},selector:function(e){var s=e.getToken(),o=0,n=null,r=!e.matchListItemsToField_||""===e.domCache.get("elemVal").trim(),a=e.seeMoreItemsClicked_?1/0:2*i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD,l=r&&!e.seeMoreItemsClicked_?Math.floor(a/e.numHeadings_):1/0;l<1&&(l=1);var h=0,u=[],c={},d=null,p=!1,q=0,m=0,f=0,A=i.Autocompleter.Base.escapeAttribute;e.options.ignoreCase&&(s=s.toLowerCase());for(var g=0,v=e.rawList_.length;g<v;++g){var _=!1;if(e.indexToHeadingLevel_[g])d=e.rawList_[g],p=!1,++q;else{var y=null,S=e.rawList_[g];r&&(++o,y=A(S));var C=null,I=!1,E=!1;if(e.add_seqnum&&(_=(C=g+1-q+"")===s,r||!_&&0!==C.indexOf(s)||(++o,E=!0,(_||o<=a)&&(C="<strong>"+C.substr(0,s.length)+"</strong>"+C.substr(s.length),I=!0,y=e.SEQ_NUM_PREFIX+C+e.SEQ_NUM_SEPARATOR+A(S)))),!E&&!r){var F=!1,L=S;e.options.ignoreCase&&(L=S.toLowerCase());for(var b=L.indexOf(s);!F&&-1!==b;)0===b?(F=!0,++o<=a&&(y="<strong>"+A(S.substr(0,s.length))+"</strong>"+A(S.substr(s.length)))):(e.options.fullSearch||/(.\b|_)./.test(L.substr(b-1,2)))&&(F=!0,++o<=a&&(y=A(S.substr(0,b))+"<strong>"+A(S.substr(b,s.length))+"</strong>"+A(S.substr(b+s.length)))),F||(b=L.indexOf(s,b+1))}var T=!1;e.multiSelect_&&(T=e.isSelected(S))&&++f,!T&&y&&(_||o<=a||e.numHeadings_>0&&r)&&(d&&!p&&(p=!0,u.push(d),++m,c[d]=[A(d),"heading"],h=0),(!r||!e.numHeadings_||h<l||_)&&(!I&&e.add_seqnum&&(y=e.SEQ_NUM_PREFIX+C+e.SEQ_NUM_SEPARATOR+y),u.push(S),_&&(n=u.length-1),c[S]=[y],r&&++h))}}var x=u.length-m;return o>x+f?(t("searchCount").innerHTML=x+" of "+o+" items total",t("moreResults").style.display="block",t("searchCount").style.display="block"):(t("moreResults").style.display="none",t("searchCount").style.display="none"),e.buildHTML(u,c,n)},buildHTML:function(t,e,s){var o,n=-1,r=null!==s;if(!this.numHeadings_&&this.matchListItemsToField_&&(r||this.suggestionMode_===i.Autocompleter.SUGGEST_SHORTEST)&&(n=r?s:this.pickBestMatch(t))>=0){var a=t[n];for(o=n;o>0;--o)t[o]=t[o-1];t[0]=a}var l="<ul>";o=0,n>=0&&(l+='<li class="suggestion">'+e[a][0]+"</li>",++o);for(var h=t.length;o<h;++o){var u=e[t[o]],c=u[1];l+=c?'<li class="'+c+'">'+u[0]+"</li>":"<li>"+u[0]+"</li>"}return l+="</ul>"},setList:function(t,s){this.listIsOriginal_=!1;var o=t.length;this.rawList_=new Array(o);for(var n=0,r=t.length;n<r;++n)this.rawList_[n]=t[n].trim();for(var a=new Array(o),l=i.Autocompleter.Base.escapeAttribute,h=0;h<o;++h)a[h]=l(this.rawList_[h]),!0!==this.add_seqnum||this.indexToHeadingLevel_[h]||(a[h]=this.SEQ_NUM_PREFIX+(h+1)+this.SEQ_NUM_SEPARATOR+a[h]);this.options.array=a,this.itemCodes_=s,this.itemToDataIndex_=null,this.enabled_=t.length>0,t.length>1?e(this.element).addClass("ac_multiple"):e(this.element).removeClass("ac_multiple"),(this.hasFocus||document.activeElement===this.element)&&this.onFocus()},setFieldToListValue:function(t){this.setFieldVal(t,!1),this.fieldValIsListVal_=!0,this.storeSelectedItem(),this.processedFieldVal_=t,this.listSelectionNotification("",!0),this.setMatchStatusIndicator(!0),this.setInvalidValIndicator(!1),this.propagateFieldChanges()},setListAndField:function(t,e,s,o){void 0===s&&(s=!1),void 0===o&&(o=!1),this.setList(t,e),i.Autocompleter.Event.notifyObservers(this.element,"LIST_ASSIGNMENT",{});var n,r=this.domCache.get("elemVal"),a=t.length;!1===s&&(n=this.autoFill_&&(1===a||a>1&&o)?this.assembleValue(t[0]):"",this.setFieldVal(n,!1),this.fieldValIsListVal_=!0),s||r===n||this.setFieldToListValue(n),this.setInvalidValIndicator(!1),this.setMatchStatusIndicator(!0),this.options.afterUpdateElement&&this.options.afterUpdateElement()},assembleValue:function(t){return t.trim()},onObserverEvent:function(){this.temporaryHide_=!0,this.hideList(),i.Autocompleter.Base.prototype.onObserverEvent.apply(this,[]),this.posAnsList(),this.showList(),this.temporaryHide_=!1},loadList:function(e,s){void 0===e&&(e=this.element.id);var o=i.Autocompleter.getFieldLookupKey(this.element);this.listLoadAttempted_=!0;var n=i.RecordDataRequester.getOutputFieldRDR(e);if(n){var r=n.getFieldData(o);if(r?this.setListAndField(r[0],r[1],!0,!1):n.assignListData(),e!==this.element.id){var a=t(s),l=[s,"EQ",i.Autocompleter.getFieldVal(a)];n.addFieldsToUpdateList(e,this,l)}}},listIsEmpty:function(){return 0===this.options.array.length},getInitialSelectionIndex:function(){var t=-1;if(""==this.domCache.get("elemVal"))if(this.defaultSelectionIndex_)t=this.defaultSelectionIndex_;else{var e=this.constructorOpts_.defaultValue;if(void 0!==e){if(this.itemCodes_)for(var s=0,o=this.itemCodes_.length;s<o;++s)this.itemCodes_[s]===e&&(t=s);if(-1===t)for(var n=0,r=this.rawList_.length;n<r;++n)this.rawList_[n]===e&&(t=n)}t>=2*i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD&&(t=-1),this.defaultSelectionIndex_=t}return t},onFocus:function(){!0===i.Autocompleter.completionOptionsScrollerClicked_?i.Autocompleter.completionOptionsScrollerClicked_=!1:(this.matchListItemsToField_=!1,this.listLoadAttempted_||!this.listIsEmpty()||this.element.comboField||this.loadList(),this.enabled_&&(this.listBelowField_=!0,this.focusInProgress_=!0,this.hideList(),i.Autocompleter.Base.prototype.onFocus.apply(this),this.element.shakeCanceled=!1,this.maybeShowList(),this.index=this.getInitialSelectionIndex(),this.index>=0&&(this.setFieldToListValue(this.listItemValue(this.getCurrentEntry())),this.element.select(),this.render()),this.focusInProgress_=!1))},maybeShowList:function(){this.activate(),this.render();var t=!1;0==this.add_seqnum?t=this.entryCount>0:this.entryCount>1?t=!0:1==this.entryCount&&(t=this.listItemValue(i.Autocompleter.listItemElements()[0])!=this.processedFieldVal_),1==t&&(this.posAnsList(),this.showList(),this.readSearchCount())},onFieldClick:function(){if(this.enabled_&&this.element.id===i.Autocompleter.currentAutoCompField_&&(!this.listShowing||this.matchListItemsToField_)){this.matchListItemsToField_=!1;var t=this.suggestionMode_;this.suggestionMode_=i.Autocompleter.NO_COMPLETION_SUGGESTIONS,this.maybeShowList(),this.suggestionMode_=t}},focusField:function(){this.element.focus()},listItemValue:function(t){var e=t.innerHTML;if(this.add_seqnum){o.IE&&(e=e.replace("SPAN","span"));var s=e.indexOf(this.SEQ_NUM_SEPARATOR);s>=0&&(e=e.substring(s+this.SEQ_NUM_SEPARATOR.length)),e=e.replace(/(<([^>]+)>)/gi,""),e=i.Autocompleter.Base.unescapeAttribute(e)}else e=t.textContent;return e},fieldEventIsBigList:function(t){return t.ctrlKey&&t.keyCode===e.ui.keyCode.ENTER},handleSeeMoreItems:function(e){this.seeMoreItemsClicked_=!0,t("searchHint").style.display="none",this.listBelowField_=!1,this.getUpdatedChoices(),this.posAnsList(),this.seeMoreItemsClicked_=!1,this.splitAutocomp_=!1,i.Autocompleter.stopEvent(e)},findItemIndexByCode:function(t){for(var e=null,i=0,s=this.itemCodes_.length;i<s&&!e;++i)t==this.itemCodes_[i]&&(e=i);return e},selectByCode:function(t){var e=this.findItemIndexByCode(t);null!=e&&this.setFieldToListValue(this.rawList_[e])},readSearchCount:function(){var t=i.Autocompleter.Base.prototype.readSearchCount.apply(this);return!t&&this.entryCount>0&&(i.Autocompleter.screenReaderLog("Showing "+this.entryCount+" of "+this.rawList_.length+" items."),t=!0),t},activate:function(){this.changed=!1,this.hasFocus=!0,this.getUpdatedChoices()}};e.extend(i.Autocompleter.Prefetch.prototype,n),n=null}}()},function(t,e,i){!function(){t.exports=function(t,e,i){"use strict";var s=i.PrototypeAPI.Class;i.Autocompleter.Search=s.create();var o={urlToCache_:{},RESULT_CACHE_AUTOCOMP_RESULTS:1,RESULT_CACHE_SEARCH_RESULTS:0,MAX_VALUE_SIZE_FOR_AUTOCOMP:25,EXPANDED_COUNT:500,constructor:i.Autocompleter.Search,superclass:i.Autocompleter.Base.prototype};e.extend(i.Autocompleter.Search,o),o=null,e.extend(i.Autocompleter.Search.prototype,i.Autocompleter.Base.prototype),i.Autocompleter.Search.prototype.className="Def.Autocompleter.Search";var n={lastAjaxRequest_:null,resultCache_:null,useResultCache_:!0,suggestionList_:null,initialize:function(s,o,n){n=e.extend({partialChars:2,onHide:e.proxy(function(e,s){t("searchCount").style.display="none",t("moreResults").style.display="none",i.Autocompleter.Base.prototype.hideList.apply(this)},this),onShow:e.proxy(function(e,s){t("searchCount").style.display="block",t("moreResults").style.display="block",i.Autocompleter.Base.prototype.showList.apply(this)},this),onComplete:e.proxy(this.onComplete,this)},n||{}),i.Autocompleter.Base.classInit_||i.Autocompleter.Base.classInit(),this.url=o,this.fhir=n.fhir,this.defAutocompleterBaseInit(s,n),this.autocomp=n.autocomp,void 0===this.autocomp?this.autocomp=!0:this.autocomp||(this.options.frequency=31536e3),void 0===n.sort&&(n.sort=!0),null!==n.useResultCache&&!1===n.useResultCache&&(this.useResultCache_=!1),e(this.element).focus(e.proxy(this.onFocus,this));var r=n.buttonID;if(this.buttonID=r,r&&"null"!==r){var a=e(document.getElementById(r));a.mousedown(e.proxy(this.buttonClick,this)),a.keypress(e.proxy(this.buttonKeyPress,this))}e(this.element).addClass("search_field"),n.colHeaders&&(this.colHeaderHTML="<table><thead><th>"+n.colHeaders.join("</th><th>")+"</th></thead><tbody>")},initItemToDataIndex:function(){this.itemToDataIndex_={}},dupForField:function(t){var e=this.dupDataReqForField(t),s=Object.clone(this.constructorOpts_);return s.dataRequester=e,new i.Autocompleter.Search(t,this.url,s)},getSearchStr:function(t){var e=i.Autocompleter;return e.LIST_ITEM_FIELD_SEP_REGEX||(e.LIST_ITEM_FIELD_SEP_REGEX=new RegExp(e.LIST_ITEM_FIELD_SEP,"g")),t||(t=this.getToken()),t.replace(e.LIST_ITEM_FIELD_SEP_REGEX," ").trimLeft()},runSearch:function(){this.lastAjaxRequest_&&this.lastAjaxRequest_.transport&&this.lastAjaxRequest_.abort();var t=this.fhir&&this.fhir.search;if(this.url||t){this.searchInProgress=!0,this.searchStartTime=(new Date).getTime();var e=this.getSearchStr(),s=null;this.useResultCache_&&(s=this.getCachedResults(e,i.Autocompleter.Search.RESULT_CACHE_SEARCH_RESULTS))&&this.onComplete(s,null,!0),s||(t?this.useSearchFn(e,i.Autocompleter.Search.EXPANDED_COUNT):this.urlSearch(e,i.Autocompleter.Search.EXPANDED_COUNT),this.changed=!1,this.hasFocus=!0)}},useSearchFn:function(t,e){var i=this;this.fhir.search(t,e).then(function(s){s.requestedCount=e,s.searchStr=t,i.onComplete(s)},function(t){console.log("FHIR search failed: "+t)})},urlSearch:function(t,s){var o={};this.fhir?(o.filter=t,o._format="application/json",o.count=s):(o.terms=t,s!=i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD&&(o.maxList=null)),window._token&&(params.authenticity_token=window._token);var n={data:o,dataType:"json",complete:this.options.onComplete};this.lastAjaxRequest_=e.ajax(this.url,n),this.lastAjaxRequest_.requestParamData_=o},initResultCache:function(){this.resultCache_=this.url?i.Autocompleter.Search.urlToCache_[this.url]:null,this.resultCache_||(this.resultCache_=[{},{}],this.url&&(i.Autocompleter.Search.urlToCache_[this.url]=this.resultCache_))},getCachedResults:function(t,e){return this.resultCache_||this.initResultCache(),this.resultCache_[e][t]},storeCachedResults:function(t,e,i){this.resultCache_||this.initResultCache(),this.resultCache_[e][t]=i},clearCachedResults:function(){this.resultCache_=[{},{}],i.Autocompleter.Search.urlToCache_[this.url]=this.resultCache_},setURL:function(t){this.url=t,this.initResultCache()},fieldEventIsBigList:function(t){return t.keyCode===e.ui.keyCode.ENTER&&(t.ctrlKey||!this.autocomp&&this.domCache.get("elemVal")!==this.processedFieldVal_&&""!==this.domCache.get("elemVal").trim())},buttonKeyPress:function(t){t.keyCode===e.ui.keyCode.ENTER&&this.runSearch()},processChoices:function(t){for(var e=[],s=Object.keys(t),o=0,n=s.length;o<n;++o){var r=s[o];this.multiSelect_&&this.isSelected(r)||e.push(r)}if(e.length>0&&!this.numHeadings_){var a=null,l=-1;if(this.suggestionMode_===i.Autocompleter.USE_STATISTICS?l=0:this.suggestionMode_===i.Autocompleter.SUGGEST_SHORTEST&&(l=this.pickBestMatch(e)),this.options.sort)l>-1&&(a=e[l],e[l]=""),e=e.sort(i.Autocompleter.Base.noCaseSort),l>-1&&(e[0]=a);else if(l>0){var h=e[0];e[0]=e[l],e[l]=h}}return[e,l>-1]},escapeHTML:function(t){return i.Autocompleter.Base.escapeAttribute(t).replace(/&lt;(\/)?span&gt;/g,"<$1span>")},buildUpdateHTML:function(t,e,s){var o,n,r,a,l,h,u,c=this.options.tableFormat;c?(n=this.colHeaderHTML||"<table><tbody>",r="</tbody></table>",a="<tr",l="><td>",h="</td><td>",u="</td></tr>"):(n="<ul>",r="</ul>",a="<li",l=">",h=i.Autocompleter.LIST_ITEM_FIELD_SEP,u="</li>"),o=n;for(var d=0,p=t.length;d<p;++d){for(var q=t[d],m=s[q],f=[],A=0,g=m.length;A<g;++A)f[A]=this.escapeHTML(m[A]);o+=a,0===d&&e&&(o+=' class="suggestion"'),c&&(o+=' data-fieldval="'+this.escapeHTML(q)+'"'),o+=l,o+=f.join(h),o+=u}return o+=r},setSearchCountDiv:function(e,i,s){var o=t("searchCount"),n="";if(e>0){n=i+" of "+e+" total";var r=(new Date).getTime()-this.searchStartTime+1e3*this.options.frequency+"",a=s+"";a.length<3&&(a+="&nbsp;");var l="; ";void 0!==s&&(l+=a+" bytes in "),l+=r+" ms",r.length<3&&(l+="&nbsp;"),n+=l,o.innerHTML=n}},createFieldVals:function(t){var e={},s=this.options.valueCols,o=i.Autocompleter.LIST_ITEM_FIELD_SEP;if(this.itemToDataIndex_={},s)var n=s.length;for(var r=0,a=t.length;r<a;++r){var l,h=t[r];if(s){l=[];for(var u=0;u<n;++u)l[u]=h[s[u]]}else l=h;var c=l.join(o);c=c.replace(/<\/?span>/g,""),this.itemToDataIndex_[c]=r,e[c]=h}return e},onComplete:function(e,s,o){var n=this.getToken();this.trimmedElemVal=n.trim(),this.lastAjaxRequest_===e&&(this.lastAjaxRequest_=null);var r="ValueSet"==e.resourceType;if(200===e.status||r){var a=e.requestParamData_;if(this.fhir)if(r)l=e.searchStr,h=e.requestedCount===i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD;else var l=a.filter,h=a.count===i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD;else l=a.terms,h=void 0===a.maxList;var u=i.Autocompleter.Search;if(!o&&this.useResultCache_){var c=h?u.RESULT_CACHE_AUTOCOMP_RESULTS:u.RESULT_CACHE_SEARCH_RESULTS;this.storeCachedResults(l,c,e)}var d=this.getSearchStr(n);if(h&&(d=d.substr(0,u.MAX_VALUE_SIZE_FOR_AUTOCOMP)),(this.hasFocus||this.refocusInProgress_)&&d===l){var p=r?e:e.responseJSON||JSON.parse(e.responseText);if(this.fhir){g=p.expansion.total,this.listExtraData_=null,this.itemCodes_=[],this.itemCodeSystems_=[],this.rawList_=[];var q=p.expansion.contains;if(q)for(var m=0,f=q.length;m<f;++m){var A=q[m];this.itemCodes_[m]=A.code,this.itemCodeSystems_[m]=A.system,this.rawList_[m]=[A.display]}}else{var g=p[0];this.itemCodes_=p[1],this.listExtraData_=p[2],this.itemCodeSystems_=p[4],this.rawList_=p[3]}var v=this.createFieldVals(this.rawList_),_=this.processChoices(v),y=_[0],S=_[1],C=this.buildUpdateHTML(y,S,v);this.updateChoices(C,!1);var I=y.length;this.setSearchCountDiv(g,I,r?void 0:e.responseText.length),t("moreResults").style.display=I<g&&h?"block":"none",this.searchInProgress=!1,this.listBelowField_=this.entryCount<=i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD,this.posAnsList()}}},getItemExtraData:function(t){var e={};if(this.listExtraData_){var i=this.itemToDataIndex_[t];if(null!=i)for(var s=Object.keys(this.listExtraData_),o=0,n=s.length;o<n;++o){var r=s[o];e[r]=this.listExtraData_[r][i]}}return e},getItemData:function(t){t||(t=this.domCache.get("elemVal"));var e={text:t};if(""!=t&&this.itemToDataIndex_){var i=this.getItemCode(t);if(null!=i&&(e.code=i,this.itemCodeSystems_)){var s=this.itemToDataIndex_[t],o=this.itemCodeSystems_[s];o&&(e.code_system=o)}var n=this.getItemExtraData(t);Object.keys(n).length>0&&(e.data=n)}return e},show:function(){"hidden"!==this.listContainer.style.visibility&&""!==this.listContainer.style.visibility||this.options.onShow(this.element,this.update)},hide:function(){this.searchInProgress||i.Autocompleter.Search.superclass.hide.apply(this)},buttonClick:function(t){this.observer&&clearTimeout(this.observer),this.searchInProgress=!0,this.runSearch(),i.Autocompleter.stopEvent(t)},handleSeeMoreItems:function(t){this.multiSelect_&&""===this.domCache.get("elemVal")&&this.preFieldFillVal_&&this.setFieldVal(this.preFieldFillVal_,!1),this.buttonClick(t)},onFocus:function(){!0===i.Autocompleter.completionOptionsScrollerClicked_?i.Autocompleter.completionOptionsScrollerClicked_=!1:(this.refocusInProgress_||(i.Autocompleter.screenReaderLog("Type to show matching list values."),this.hide(),this.rawList_=[]),i.Autocompleter.Base.prototype.onFocus.apply(this),this.hasFocus=!0)},onBlur:function(t){this.refocusInProgress_||i.Autocompleter.completionOptionsScrollerClicked_||(i.Autocompleter.Base.prototype.onBlur.apply(this,[t]),this.searchInProgress||(this.active=!1))},getUpdatedChoices:function(){this.lastAjaxRequest_&&this.lastAjaxRequest_.transport&&this.lastAjaxRequest_.abort();var t=this.fhir&&this.fhir.search;if(this.url||t){this.searchStartTime=(new Date).getTime();var e=null,s=i.Autocompleter.Search,o=this.getSearchStr();o.length>s.MAX_VALUE_SIZE_FOR_AUTOCOMP&&(o=o.substr(0,s.MAX_VALUE_SIZE_FOR_AUTOCOMP)),this.useResultCache_&&(e=this.getCachedResults(o,s.RESULT_CACHE_AUTOCOMP_RESULTS))&&this.onComplete(e,null,!0),e||(t?this.useSearchFn(o,i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD):this.urlSearch(o,i.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD))}},findSuggestions:function(){if(this.url){var t={field_val:this.getSearchStr(),suggest:1};window._token&&(params.authenticity_token=window._token);var i={data:t,complete:e.proxy(this.onFindSuggestionComplete,this)};e.ajax(this.url,i)}},onFindSuggestionComplete:function(t){if(200===t.status){var e=t.responseJSON||JSON.parse(t.responseText),s=[],o=!1;if(e[0].length>0){var n=e[1];this.suggestionList_=e;for(var r=this.domCache.get("elemVal").trim().toLowerCase(),a=i.Autocompleter.LIST_ITEM_FIELD_SEP,l=0,h=n.length;!o&&l<h;++l)n[l]=n[l].join(a),n[l].toLowerCase()===r&&(o=!0,this.observer&&clearTimeout(this.observer),this.acceptSuggestion(l));o||(s=n)}o||i.Autocompleter.Event.notifyObservers(this.element,"SUGGESTIONS",{suggestion_list:s})}},acceptSuggestion:function(t){var e=this.suggestionList_[0],s=this.suggestionList_[1],o=s[t],n=this.domCache.get("elemVal");s[t],this.setFieldVal(this.processedFieldVal_=o,!1),this.setMatchStatusIndicator(!0),this.fieldValIsListVal_=!0,this.propagateFieldChanges(),i.Autocompleter.Event.notifyObservers(this.element,"SUGGESTION_USED",{suggestion_used:o}),this.itemCodes_=e,this.itemToDataIndex_={},this.itemToDataIndex_[s[t]]=t,this.listExtraData_=this.suggestionList_[2],this.itemCodeSystems_=this.suggestionList_[3],this.listSelectionNotification(n,!0),this.element.focus()}};e.extend(i.Autocompleter.Search.prototype,n),n=null}}()},function(t,e,i){!function(){t.exports=function(t,e,i){"use strict";i.Autocompleter.Event={observeListExpansions:function(t,e){this.storeCallback(t,"LIST_EXP",e)},observeListSelections:function(t,e){this.storeCallback(t,"LIST_SEL",e)},observeFocusEvents:function(t,e){this.storeCallback(t,"FOCUS",e)},observeCancelList:function(t,e){this.storeCallback(t,"CANCEL",e)},observeSuggestions:function(t,e){this.storeCallback(t,"SUGGESTIONS",e)},observeSuggestionUsed:function(t,e){this.storeCallback(t,"SUGGESTION_USED",e)},observeListAssignments:function(t,e){this.storeCallback(t,"LIST_ASSIGNMENT",e)},observeRDRClearing:function(t){this.storeCallback(null,"RDR_CLEARING",t)},observeRDRAssignment:function(t){this.storeCallback(null,"RDR_ASSIGNMENT",t)}},e.extend(i.Autocompleter.Event,i.Observable)}}()},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(){t.exports=function(t){"use strict";var e=t.PrototypeAPI.Class.create({initialize:function(t,e,i,s){if(this.displayedProp=t.display||"text",this.scope=e,this.acOptions=t,s){this.pElem=i[0];var o=this.pElem.autocomp;o&&(o.destroy(),e.modelData=null,this.removeAutocompFunction(s.$formatters),this.removeAutocompFunction(s.$parsers));var n=t.hasOwnProperty("url")||t.fhir&&t.fhir.search;this.ac=n?this.searchList():this.prefetchList();var r=e.modelData;if(null!=r)if(this.ac.multiSelect_){for(var a=0,l=r.length;a<l;++a){var h=r[a][this.displayedProp];this.ac.storeSelectedItem(h,r[a].code),this.ac.addToSelectedArea(h)}this.ac.setFieldVal("",!1)}else"string"==typeof(h=r[this.displayedProp])?(this.ac.storeSelectedItem(h,r.code),this.ac.setFieldVal(h,!1)):this.ac.setFieldVal("",!1);this.parser=this.parser.bind(this),this.parser.fromAutocomp=!0,s.$parsers.push(this.parser),this.formatter=this.formatter.bind(this),this.formatter.fromAutocomp=!0,s.$formatters.push(this.formatter)}},parser:function(t){var e=this.scope.modelData;return void 0===e&&(e=null),e},formatter:function(t){var e="";return this.ac.multiSelect_?e="":("string"==typeof t?e=t:null!==t&&"object"===s(t)&&"string"==typeof t[this.displayedProp]&&(e=t[this.displayedProp]),e=e.trim()),this.ac.setFieldVal(e,!1),e},getPrefetchItemModelData:function(t,e){var i=e[t];return i||(""!=t?(i={_notOnList:!0})[this.displayedProp]=t:i=null),i},prefetchListSelHandler:function(t,e){var i=t.final_val;if(this.ac.multiSelect_){this.scope.modelData||(this.scope.modelData=[]);var s=this.scope.modelData;if(t.removed){for(var o=t.final_val,n=0,r=s.length;n<r;++n)if(o===s[n][this.displayedProp]){s.splice(n,1);break}}else if(t.on_list||!this.acOptions.matchListValue){var a=this.getPrefetchItemModelData(i,e);a&&s.push(a)}}else this.scope.modelData=this.getPrefetchItemModelData(i,e)},prefetchList:function(){var e=[],i={},s=this.acOptions,o=null,n=s.defaultValue,r=null,a=this.displayedProp;void 0===n||void 0!==this.scope.modelData&&null!==this.scope.modelData||("string"==typeof n?(o=a,r=n):r=n[o=Object.keys(n)[0]]);for(var l,h=null,u=0,c=s.listItems.length;u<c;++u){var d=s.listItems[u];l=d[a],e[u]=l;var p=l.trim();i[p]=d,o&&d[o].trim()===r&&(h=this.getPrefetchItemModelData(p,i))}var q=new t.Autocompleter.Prefetch(this.pElem,e,s);this.addNameAttr();var m=this;return this.updateListSelectionHandler(function(t){m.scope.$apply(function(){m.prefetchListSelHandler(t,i)})}),null===h||this.scope.modelData||(this.scope.modelData=q.multiSelect_?[h]:h),q},getSearchItemModelData:function(t,e){var i;return""===t?i=null:(i=this.ac.getItemData(t),e||(i._notOnList=!0)),i},addNameAttr:function(){""===this.pElem.name&&(this.pElem.name=this.pElem.id)},searchListSelHandler:function(t){var e=t.final_val,i=t.on_list;if(this.ac.multiSelect_){this.scope.modelData||(this.scope.modelData=[]);var s=this.scope.modelData;if(t.removed){for(var o=t.final_val,n=0,r=s.length;n<r;++n)if(o===s[n].text){s.splice(n,1);break}}else if(t.on_list||!this.acOptions.matchListValue){var a=this.getSearchItemModelData(e,i);a&&s.push(a)}}else this.scope.modelData=this.getSearchItemModelData(e,i)},searchList:function(){var e=new t.Autocompleter.Search(this.pElem,this.acOptions.url,this.acOptions);this.addNameAttr();var i=this;return this.updateListSelectionHandler(function(t){i.scope.$apply(function(){i.searchListSelHandler(t)})}),e},removeAutocompFunction:function(t){for(var e=0,i=t.length;e<i;++e)if(t[e].fromAutocomp){t.splice(e,1);break}},updateListSelectionHandler:function(e){var i=this.pElem,s=t.Observable.lookupKey(i),o=t.Autocompleter.directiveListEventHandlers,n=o[i.id];n&&t.Autocompleter.Event.removeCallback(s,"LIST_SEL",n),t.Autocompleter.Event.observeListSelections(s,e),o[i.id]=e}});t.Autocompleter.directiveListEventHandlers={},"undefined"!=typeof angular&&angular.module("autocompleteLhcMod",[]).directive("autocompleteLhc",[function(){return{restrict:"A",require:"?ngModel",scope:{modelData:"=ngModel",acOpts:"=autocompleteLhc"},link:function(t,i,s,o){o.$options||(o.$options={}),o.$options.updateOn="none",o.$options.updateOnDefault=!1,t.$watch("acOpts",function(s){new e(s,t,i,o)},!0)}}}])}}()}]);